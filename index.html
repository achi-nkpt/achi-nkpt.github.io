<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EasyRail | Thailand Transit Guide</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --sidebar-bg: #0f172a; --primary: #2563eb; --accent: #f59e0b; --bg: #f1f5f9;
            --c-bts-g: #16a34a; --c-bts-s: #15803d; --c-mrt-b: #1d4ed8; --c-mrt-p: #7e22ce; 
            --c-arl: #701a75; --c-red: #b91c1c; --c-gold: #ca8a04; --c-yl: #eab308; --c-pk: #db2777; --c-srt: #854d0e;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); color: #1e293b; height: 100vh; display: flex; overflow: hidden; }
        
        /* SIDEBAR */
        .sidebar { width: 280px; background: var(--sidebar-bg); color: white; padding: 25px; display: flex; flex-direction: column; gap: 20px; flex-shrink: 0; overflow-y: auto; }
        .logo { font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; gap: 10px; margin-bottom: 10px; color: white; text-decoration: none; }
        .nav-section { margin-bottom: 15px; }
        .nav-label { font-size: 0.7rem; text-transform: uppercase; color: #94a3b8; font-weight: 700; letter-spacing: 1px; margin-bottom: 8px; }
        .nav-btn { width: 100%; padding: 12px 15px; border: none; border-radius: 8px; background: rgba(255,255,255,0.05); color: #cbd5e1; text-align: left; font-family: inherit; font-size: 0.9rem; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 10px; font-weight: 500; margin-bottom: 5px; }
        .nav-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .nav-btn.active { background: var(--primary); color: white; font-weight: 600; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); border: 1px solid rgba(255,255,255,0.2); }
        .nav-btn.link { border: 1px solid rgba(255,255,255,0.15); background: transparent; color: #94a3b8; }
        .nav-btn.link:hover { border-color: white; color: white; }

        /* MAIN CONTENT */
        .main { flex: 1; position: relative; overflow-y: auto; display: flex; flex-direction: column; }
        .hero { height: 350px; flex-shrink: 0; position: relative; background: linear-gradient(to bottom, rgba(15,23,42,0.5), rgba(15,23,42,0.8)), url('https://internationalliving.com/_next/image/?url=https%3A%2F%2Fimages.ctfassets.net%2Fwv75stsetqy3%2FDaKdXY2tkQGWeVQiCbSx7%2Fac01166282697e4e0cafb99180d35cd1%2FThailand_Featured.jpg%3Fq%3D60%26fit%3Dfill%26fm%3Dwebp&w=1920&q=60') center/cover; }
        .search-container { max-width: 800px; margin: -100px auto 40px; padding: 0 20px; position: relative; z-index: 10; width: 100%; box-sizing: border-box; }
        .search-card { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 20px 40px -10px rgba(0,0,0,0.15); }
        h1 { margin: 0 0 10px 0; font-size: 1.8rem; font-weight: 800; color: var(--sidebar-bg); }
        p.sub { color: #64748b; margin-bottom: 25px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; font-size: 0.9rem; }
        input { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 1rem; box-sizing: border-box; transition: 0.2s; }
        input:focus { border-color: var(--primary); outline: none; }
        .action-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .action-btn:hover { background: #1d4ed8; }
        .results-wrapper { margin-top: 30px; display: none; }
        .result-card { background: #f0fdf4; border: 2px solid #16a34a; border-radius: 12px; padding: 25px; width: 100%; box-sizing: border-box; }
        .res-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #dcfce7; padding-bottom: 15px; }
        .tag { font-size: 0.8rem; font-weight: 700; text-transform: uppercase; padding: 6px 12px; border-radius: 6px; background: #166534; color: white; }
        .price { font-size: 2.2rem; font-weight: 800; color: #15803d; }
        .route-step { display: flex; gap: 15px; margin-bottom: 18px; font-size: 1rem; align-items: flex-start; }
        .icon { font-size: 1.2rem; min-width: 30px; text-align: center; }
        .line-dot { width: 14px; height: 14px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
        .step-info h4 { margin: 0; font-weight: 700; font-size: 1.05rem; }
        .step-info p { margin: 4px 0 0; color: #64748b; font-size: 0.9rem; }
        .disclaimer { margin-top: 20px; text-align: center; color: #94a3b8; font-size: 0.8rem; font-style: italic; }
        
        /* INFO SECTION STYLES (NEW) */
        .info-section { max-width: 1000px; margin: 0 auto 40px; padding: 0 20px; width: 100%; box-sizing: border-box; }
        .section-title { font-size: 1.5rem; font-weight: 800; color: var(--sidebar-bg); margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .info-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .info-card { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: 0.2s; border-left: 5px solid var(--primary); }
        .info-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        .info-card h3 { margin: 0 0 10px 0; font-size: 1.1rem; color: #1e293b; }
        .info-card p { margin: 0; font-size: 0.95rem; color: #64748b; line-height: 1.6; }
        
        .credits { margin-top: 25px; padding-top: 15px; border-top: 1px solid #e2e8f0; text-align: center; font-size: 0.85rem; color: #64748b; }
        .credits a { color: var(--primary); text-decoration: none; font-weight: 600; }

        .bg-BTS_G { background: var(--c-bts-g); } .bg-BTS_S { background: var(--c-bts-s); } .bg-MRT_B { background: var(--c-mrt-b); } .bg-MRT_P { background: var(--c-mrt-p); }
        .bg-ARL { background: var(--c-arl); } .bg-Red { background: var(--c-red); } .bg-SRT { background: var(--c-srt); } .bg-Yellow { background: var(--c-yl); } .bg-Pink { background: var(--c-pk); } .bg-Gold { background: var(--c-gold); }
        @media (max-width: 900px) { body { flex-direction: column; overflow: auto; height: auto; } .sidebar { width: 100%; height: auto; padding: 20px; box-sizing: border-box; } .main { overflow: visible; } .hero { height: 250px; } .search-container { margin-top: -80px; } .form-grid { grid-template-columns: 1fr; } }
    </style>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1332950063229500" crossorigin="anonymous"></script>
</head>
<body>

<div class="sidebar">
    <a href="#" class="logo">üöÜ EasyRail TH</a>
    <div class="nav-section">
        <div class="nav-label">Search Mode</div>
        <button id="btn-station" class="nav-btn active" onclick="setMode('station', this)">üöâ Station Search</button>
        <button id="btn-landmark" class="nav-btn" onclick="setMode('landmark', this)">üìç Landmark Search</button>
    </div>
    <div class="nav-section" id="filter-group">
        <div class="nav-label">Filter Lines</div>
        <button class="nav-btn active" onclick="filterStations('All', this)">üîÑ Show All</button>
        <button class="nav-btn" onclick="filterStations('BTS', this)">üöÜ BTS Skytrain</button>
        <button class="nav-btn" onclick="filterStations('MRT', this)">üöá MRT Subway</button>
        <button class="nav-btn" onclick="filterStations('Airport', this)">‚úàÔ∏è Airport / Red</button>
        <button class="nav-btn" onclick="filterStations('Monorail', this)">üöù Monorail (Y/P/G)</button>
        <button class="nav-btn" onclick="filterStations('SRT', this)">üöÇ Diesel / Intercity</button>
    </div>
    <div class="nav-section">
        <div class="nav-label">Booking & Official</div>
        <button class="nav-btn link" onclick="window.open('https://dticket.railway.co.th/DTicketPublicWeb/home/Home', '_blank')">üé´ Book SRT Tickets</button>
        <button class="nav-btn link" onclick="window.open('https://www.bts.co.th/index.html', '_blank')">üöÜ BTS Official Site</button>
        <button class="nav-btn link" onclick="window.open('https://metro.bemplc.co.th/Fare-Calculation', '_blank')">üöá MRT Official Site</button>
    </div>
    <div class="nav-section">
        <div class="nav-label">Tools</div>
        <button class="nav-btn link" onclick="window.open('https://www.bangkoktransitmap.com/', '_blank')">üó∫Ô∏è Official System Map</button>
        <button class="nav-btn link" onclick="window.open('https://www.railway.co.th/SRTTimetable/StationList', '_blank')">üïí SRT Timetable</button>
    </div>
</div>

<div class="main">
    <div class="hero"></div>
    
    <div class="search-container">
        <div class="search-card">
            <h1>Route Finder</h1>
            <p class="sub">Bangkok's best transit routing engine.</p>
            <div class="form-grid">
                <div class="input-group">
                    <label>Start From</label>
                    <input type="text" id="start" list="stations-list" placeholder="Select origin station...">
                </div>
                <div class="input-group">
                    <label id="dest-label">Destination</label>
                    <input type="text" id="end" list="stations-list" placeholder="Select destination station...">
                </div>
            </div>
            <button class="action-btn" onclick="calculateRoute()">Find Best Route</button>
            <div id="results-area" class="results-wrapper">
                <div class="result-card best">
                    <div class="res-header">
                        <span class="tag">‚ö° Recommended Route</span>
                        <div style="text-align:right;">
                            <div class="price" id="res-price">‡∏ø0</div>
                            <small style="color:#166534">Total Fare</small>
                        </div>
                    </div>
                    <div id="res-steps"></div>
                </div>
            </div>
            <div class="disclaimer">EasyRail Thailand can make mistakes, please check twice.</div>
        </div>
    </div>

    <div class="info-section">
        <div class="section-title">üöÜ Thailand Train Guide</div>
        <div class="info-grid">
            <div class="info-card" style="border-color: #16a34a;">
                <h3>BTS Skytrain (Green)</h3>
                <p>The <strong>BTS Skytrain</strong> is the fastest way to get around downtown Bangkok. It has two lines: the Sukhumvit Line (Khu Khot to Kheha) and the Silom Line (National Stadium to Bang Wa). It covers major shopping areas like Siam, Chit Lom, and Chatuchak Market.</p>
            </div>
            <div class="info-card" style="border-color: #1d4ed8;">
                <h3>MRT Subway (Blue/Purple)</h3>
                <p>The <strong>MRT Blue Line</strong> loops around Bangkok, connecting the old city (Grand Palace, Chinatown) with the new business districts (Asok, Rama 9). It connects with the BTS at several points like Sukhumvit and Silom.</p>
            </div>
            <div class="info-card" style="border-color: #701a75;">
                <h3>Airport Rail Link (ARL)</h3>
                <p>The <strong>ARL</strong> connects Suvarnabhumi Airport (BKK) directly to Phaya Thai station in the city center. It takes about 30 minutes and is much cheaper than a taxi. It's the best option for arriving tourists.</p>
            </div>
            <div class="info-card" style="border-color: #b91c1c;">
                <h3>SRT Red Line</h3>
                <p>The new <strong>SRT Red Line</strong> is a commuter train connecting Bangkok (Bang Sue Grand Station) to the northern suburbs (Rangsit) and Don Mueang Airport (DMK). It is modern, electric, and very affordable.</p>
            </div>
            <div class="info-card" style="border-color: #854d0e;">
                <h3>SRT Intercity Trains</h3>
                <p>The classic diesel trains operated by the State Railway of Thailand. These trains take you outside Bangkok to places like <strong>Ayutthaya, Hua Hin, Pattaya, and Chiang Mai</strong>. Prices for 3rd class tickets are extremely cheap.</p>
            </div>
        </div>

        <div class="section-title">üìç Popular Destinations</div>
        <div class="info-grid">
            <div class="info-card">
                <h3>Bangkok Highlights</h3>
                <p>Visit the <strong>Grand Palace</strong> and <strong>Wat Arun</strong> via MRT Sanam Chai. Shop at <strong>Siam Paragon</strong> (BTS Siam) or explore the weekend market at <strong>Chatuchak</strong> (BTS Mo Chit / MRT Chatuchak Park).</p>
            </div>
            <div class="info-card">
                <h3>Ayutthaya Ancient City</h3>
                <p>Take an SRT train from Bang Sue Junction or Hua Lamphong. The trip takes 1.5-2 hours. You will see ancient temples and ruins from the old capital of Thailand. Fare is as low as 15 Baht.</p>
            </div>
            <div class="info-card">
                <h3>Pattaya & Beaches</h3>
                <p>Pattaya is famous for its beaches and nightlife (Walking Street). You can take a train from Bangkok to Pattaya station. It is a cost-effective way to reach the eastern coast.</p>
            </div>
            <div class="info-card">
                <h3>Chiang Mai (North)</h3>
                <p>The northern capital of Thailand. Famous for <strong>Doi Suthep</strong> temple and the cool mountain weather. The overnight sleeper train from Bangkok is a popular experience for travelers.</p>
            </div>
        </div>

        <div class="credits">
            Created by Achirawat Nikropitak contact: <a href="https://sites.google.com/view/achi-nkpt/home" target="_blank">Click here</a>
        </div>
    </div>

</div>

<datalist id="stations-list"></datalist>
<datalist id="landmarks-list">
    <option value="Siam Paragon (Mall)">
    <option value="Central World (Mall)">
    <option value="Icon Siam (Mall)">
    <option value="Chatuchak Market (Market)">
    <option value="Grand Palace (Temple)">
    <option value="Wat Arun (Temple)">
    <option value="Khaosan Road (Nightlife)">
    <option value="Suvarnabhumi Airport (BKK)">
    <option value="Don Mueang Airport (DMK)">
    <option value="Doi Suthep (Chiang Mai)">
    <option value="Walking Street (Pattaya)">
    <option value="Hua Hin Beach">
    <option value="Bridge Over the River Kwai (Kanchanaburi)">
</datalist>

<script>
    // ==========================================
    // 1. FARE TABLES (Nov 2025)
    // ==========================================
    const FARE_TABLES = {
        "BTS_G": [0, 17, 25, 28, 32, 35, 40, 43, 47, 52, 57, 62, 65, 65, 65, 65, 65],
        "BTS_S": [0, 17, 25, 28, 32, 35, 40, 43, 47, 52, 57, 62],
        "MRT_B": [0, 17, 20, 22, 25, 27, 30, 32, 35, 38, 40, 42, 45, 45, 45],
        "MRT_P": [0, 14, 17, 20, 23, 26, 29, 32, 35, 38, 41, 42],
        "Red":   [0, 12, 15, 18, 21, 24, 27, 30, 33, 36, 39, 42],
        "ARL":   [0, 15, 20, 25, 30, 35, 40, 45],
        "Yellow":[0, 15, 19, 23, 27, 31, 35, 39, 43, 45],
        "Pink":  [0, 15, 19, 23, 27, 31, 35, 39, 43, 45],
        "Gold":  [16], 
        "SRT": {
            "Lat Krabang": 6, "Phaya Thai": 2, "Makkasan": 2, "Hua Lamphong": 2,
            "Ayutthaya": 15, "Lopburi": 28, "Pattaya": 31, "Hua Hin": 44,
            "Chiang Mai": 231, "Hat Yai": 339, "Nong Khai": 253, "Kanchanaburi": 100
        }
    };

    const lineData = {
        "BTS_G": ["Khu Khot", "Yaek Kor Por Aor", "Royal Thai Air Force Museum", "Bhumibol Adulyadej Hospital", "Saphan Mai", "Sai Yud", "Phahon Yothin 59", "Wat Phra Sri Mahathat", "11th Infantry Regiment", "Bang Bua", "Royal Forest Department", "Kasetsart University", "Sena Nikhom", "Ratchayothin", "Phahon Yothin 24", "Ha Yaek Lat Phrao", "Mo Chit", "Saphan Khwai", "Ari", "Sanam Pao", "Victory Monument", "Phaya Thai", "Ratchathewi", "Siam", "Chit Lom", "Phloen Chit", "Nana", "Asok", "Phrom Phong", "Thong Lo", "Ekkamai", "Phra Khanong", "On Nut", "Bang Chak", "Punnawithi", "Udom Suk", "Bang Na", "Bearing", "Samrong", "Pu Chao", "Chang Erawan", "Royal Thai Naval Academy", "Pak Nam", "Srinagarindra", "Phraek Sa", "Sai Luat", "Kheha"],
        "BTS_S": ["National Stadium", "Siam", "Ratchadamri", "Sala Daeng", "Chong Nonsi", "Saint Louis", "Surasak", "Saphan Taksin", "Krung Thon Buri", "Wongwian Yai", "Pho Nimit", "Talat Phlu", "Wutthakat", "Bang Wa"],
        "MRT_B": ["Tha Phra", "Charan 13", "Fai Chai", "Bang Khun Non", "Bang Yi Khan", "Sirindhorn", "Bang Phlat", "Bang O", "Bang Pho", "Tao Poon", "Bang Sue", "Kamphaeng Phet", "Chatuchak Park", "Phahon Yothin", "Lat Phrao", "Ratchadaphisek", "Sutthisan", "Huai Khwang", "Thailand Cultural Centre", "Phra Ram 9", "Phetchaburi", "Sukhumvit", "Queen Sirikit Center", "Khlong Toei", "Lumphini", "Silom", "Sam Yan", "Hua Lamphong", "Wat Mangkon", "Sam Yot", "Sanam Chai", "Itsaraphap", "Bang Phai", "Bang Wa", "Phetkasem 48", "Phasi Charoen", "Bang Khae", "Lak Song"],
        "MRT_P": ["Khlong Bang Phai", "Talad Bang Yai", "Sam Yaek Bang Yai", "Bang Phlu", "Bang Rak Yai", "Bang Rak Noi Tha It", "Sai Ma", "Phra Nang Klao Bridge", "Yaek Nonthaburi 1", "Bang Krasor", "Nonthaburi Civic Center", "Ministry of Public Health", "Yaek Tiwanon", "Wong Sawang", "Bang Son", "Tao Poon"],
        "ARL": ["Phaya Thai", "Ratchaprarop", "Makkasan", "Ramkhamhaeng", "Hua Mak", "Ban Thap Chang", "Lat Krabang", "Suvarnabhumi"],
        "Red": ["Taling Chan", "Bang Bamru", "Bang Son", "Bang Sue", "Chatuchak", "Wat Samian Nari", "Bang Khen", "Thung Song Hong", "Lak Si", "Kan Kheha", "Don Mueang", "Lak Hok", "Rangsit"],
        "Yellow": ["Lat Phrao", "Phawana", "Chok Chai 4", "Lat Phrao 71", "Lat Phrao 83", "Mahat Thai", "Bang Kapi", "Yaek Lam Sali", "Si Kritha", "Hua Mak", "Kalantan", "Si Nut", "Srinagarindra 38", "Suan Luang Rama 9", "Si Udom", "Si Iam", "Si La Salle", "Si Bearing", "Si Dan", "Si Thepha", "Thipphawan", "Samrong"],
        "Pink": ["Nonthaburi Civic Center", "Khae Rai", "Sanambin Nam", "Samakkhi", "Irrigation Department", "Pak Kret", "Liang Mueang Pak Kret", "Chaeng Watthana-Pak Kret 28", "Si Rat", "Mueang Thong Thani", "Chaeng Watthana 14", "Government Complex", "TOT", "Lak Si", "Rajabhat Phranakhon", "Wat Phra Sri Mahathat", "Ram Inthra 3", "Lat Pla Khao", "Ram Inthra Kor Mor 4", "Maiyalap", "Vacharaphol", "Ram Inthra Kor Mor 6", "Khu Bon", "Ram Inthra Kor Mor 9", "Outer Ring Road", "Nopparat", "Bang Chan", "Setthabutbamphen", "Min Buri Market", "Min Buri"],
        "Gold": ["Krung Thon Buri", "Charoen Nakhon", "Khlong San"],
        "SRT": ["Bangkok (Hua Lamphong)", "Urupong", "Phaya Thai", "Makkasan", "Asok", "Khlong Tan", "Sukhumvit 71", "Hua Mak", "Ban Thap Chang", "Soi Wat Lan Boon", "Lat Krabang", "Hua Takhe", "Chachoengsao", "Ayutthaya", "Lopburi", "Nakhon Sawan", "Phitsanulok", "Chiang Mai", "Saraburi", "Pak Chong", "Nakhon Ratchasima", "Buriram", "Surin", "Ubon Ratchathani", "Khon Kaen", "Udon Thani", "Nong Khai", "Nakhon Pathom", "Ratchaburi", "Phetchaburi", "Hua Hin", "Chumphon", "Surat Thani", "Hat Yai", "Pattaya", "Aranyaprathet", "Kanchanaburi", "Nam Tok", "Maha Chai", "Yala", "Su-ngai Kolok", "Padang Besar", "Sam Sen", "Bang Sue Junction", "Bang Khen", "Lak Si", "Don Mueang", "Rangsit"]
    };

    const stations = [];
    for (const [line, list] of Object.entries(lineData)) {
        list.forEach((name, index) => {
            stations.push({ n: name, l: line, idx: index });
        });
    }

    const graph = {
        "BTS_G": ["BTS_S", "MRT_B", "ARL", "Pink", "Yellow", "SRT"], "BTS_S": ["BTS_G", "MRT_B", "Gold"],
        "MRT_B": ["BTS_G", "BTS_S", "ARL", "Yellow", "Red", "Purple", "SRT"], "MRT_P": ["MRT_B", "Pink", "Red"],
        "ARL":   ["BTS_G", "MRT_B", "Yellow", "SRT"], "Red":   ["MRT_B", "MRT_P", "Pink", "SRT"],
        "Pink":  ["MRT_P", "Red", "BTS_G"], "Yellow":["MRT_B", "BTS_G", "ARL"],
        "Gold":  ["BTS_S"], "SRT":   ["MRT_B", "Red", "ARL", "BTS_G"] 
    };

    function getInterchange(l1, l2) {
        const pair = [l1, l2].sort().join("-");
        const map = {
            "ARL-BTS_G": "Phaya Thai", "ARL-MRT_B": "Makkasan / Phetchaburi", "ARL-SRT": "Lat Krabang",
            "BTS_G-BTS_S": "Siam", "BTS_G-MRT_B": "Asok / Sukhumvit", "BTS_G-SRT": "Phaya Thai",
            "BTS_S-MRT_B": "Sala Daeng / Silom", "MRT_B-Red": "Bang Sue"
        };
        return map[pair] || "Central Hub";
    }

    let searchMode = 'station';
    const landmarkMap = { 
        "siam paragon": "Siam", "central world": "Siam", "icon siam": "Charoen Nakhon", "chatuchak market": "Chatuchak Park", "grand palace": "Sanam Chai", "suvarnabhumi airport": "Suvarnabhumi", "don mueang airport": "Don Mueang", "jodd fairs": "Phra Ram 9", "khaosan road": "Sanam Chai", "yaowarat": "Wat Mangkon", "chinatown": "Wat Mangkon", "jim thompson": "National Stadium", "asiatique": "Saphan Taksin", "mahanakhon": "Chong Nonsi",
        "doi suthep": "Chiang Mai", "nimman": "Chiang Mai", "ayutthaya historical": "Ayutthaya", "walking street": "Pattaya", "pattaya beach": "Pattaya", "sanctuary of truth": "Pattaya", "hua hin beach": "Hua Hin", "cicada": "Hua Hin", "river kwai": "Kanchanaburi"
    };

    function init() { populateList('All'); }

    function populateList(filter) {
        const dl = document.getElementById('stations-list');
        dl.innerHTML = "";
        stations.forEach(s => {
            let type = "Other";
            if(s.l.includes("BTS")) type = "BTS"; if(s.l.includes("MRT")) type = "MRT";
            if(s.l === "ARL" || s.l === "Red") type = "Airport";
            if(s.l === "Yellow" || s.l === "Pink" || s.l === "Gold") type = "Monorail";
            if(s.l === "SRT") type = "SRT";
            if(filter === 'All' || type === filter) {
                let opt = document.createElement('option');
                opt.value = `${s.n} (${getFriendlyName(s.l)})`;
                dl.appendChild(opt);
            }
        });
    }

    function getFriendlyName(code) {
        const n = {"BTS_G":"BTS Sukhumvit","BTS_S":"BTS Silom","MRT_B":"MRT Blue","MRT_P":"MRT Purple","ARL":"Airport Link","Red":"SRT Red","Yellow":"MRT Yellow","Pink":"MRT Pink","Gold":"Gold Line","SRT":"Train"};
        return n[code] || code;
    }

    function filterStations(type, btn) {
        populateList(type);
        document.getElementById('start').value = ""; document.getElementById('end').value = "";
        document.querySelectorAll('#filter-group .nav-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function setMode(mode, btn) {
        searchMode = mode;
        const endInput = document.getElementById('end');
        document.getElementById('btn-station').classList.remove('active');
        document.getElementById('btn-landmark').classList.remove('active');
        btn.classList.add('active');
        endInput.setAttribute('list', mode === 'landmark' ? 'landmarks-list' : 'stations-list');
        endInput.placeholder = mode === 'landmark' ? "Type a landmark..." : "Destination Station...";
    }

    function findStation(input) {
        let match = stations.find(s => `${s.n} (${getFriendlyName(s.l)})` === input);
        if (match) return match;
        match = stations.find(s => s.n.toLowerCase() === input.toLowerCase());
        if (match) return match;
        const lastParen = input.lastIndexOf(' (');
        if (lastParen > -1) {
            const potentialName = input.substring(0, lastParen);
            match = stations.find(s => s.n.toLowerCase() === potentialName.toLowerCase());
            if (match) return match;
        }
        return null;
    }

    function findPath(startLine, endLine) {
        if(startLine === endLine) return [startLine];
        let queue = [[startLine]];
        let visited = new Set();
        while(queue.length > 0) {
            let path = queue.shift();
            let node = path[path.length-1];
            if(node === endLine) return path;
            if(!visited.has(node) && graph[node]) {
                visited.add(node);
                for(let neighbor of graph[node]) {
                    let newPath = [...path, neighbor];
                    queue.push(newPath);
                }
            }
        }
        return null;
    }

    // Helper: Find station index dynamically
    function getStationIndex(name, lineCode) {
        const s = stations.find(st => st.n.toLowerCase() === name.toLowerCase() && st.l === lineCode);
        return s ? s.idx : -1;
    }

    function calculateRoute() {
        let startRaw = document.getElementById('start').value;
        let endRaw = document.getElementById('end').value;
        const resArea = document.getElementById('results-area');

        let endInputVal = endRaw;
        if(searchMode === 'landmark') {
            const key = endRaw.toLowerCase();
            for(let k in landmarkMap) {
                if(key.includes(k)) { endInputVal = landmarkMap[k]; break; }
            }
        }

        const startObj = findStation(startRaw);
        const endObj = findStation(endInputVal);

        if(!startObj || !endObj) { alert("Station not found. Please use the dropdown."); return; }

        resArea.style.display = 'block';
        const path = findPath(startObj.l, endObj.l);
        
        let html = `<div class="route-step"><div class="line-dot" style="background:#333"></div><div class="step-info"><h4>Start at ${startObj.n}</h4><p>Tap in at gate</p></div></div>`;
        let totalCost = 0;

        if (path.length === 1) {
            const dist = Math.abs(startObj.idx - endObj.idx);
            let fare = getStoredFare(startObj.l, dist, startObj.n, endObj.n);
            totalCost += fare;
            html += `<div class="route-step"><div class="line-dot bg-${startObj.l}"></div><div class="step-info"><h4>Ride ${getFriendlyName(startObj.l)}</h4><p>Travel ${dist} stations</p></div></div>`;
        } else {
            // DYNAMIC CALCULATION LOGIC
            for(let i=0; i<path.length; i++) {
                let currLine = path[i];
                let nextLine = path[i+1];
                let dist = 5; 
                let legStartName, legEndName;

                // 1. Determine Start Name for this leg
                if (i === 0) {
                    legStartName = startObj.n; 
                } else {
                    let prevLine = path[i-1];
                    let interStr = getInterchange(prevLine, currLine);
                    // Match interchange name to current line (handle "Makkasan / Phetchaburi")
                    let options = interStr.split(' / ');
                    legStartName = options.find(opt => getStationIndex(opt, currLine) !== -1) || options[0];
                }

                // 2. Determine End Name for this leg
                if (i === path.length - 1) {
                    legEndName = endObj.n;
                } else {
                    let interStr = getInterchange(currLine, nextLine);
                    let options = interStr.split(' / ');
                    legEndName = options.find(opt => getStationIndex(opt, currLine) !== -1) || options[0];
                }

                // 3. Calculate Dynamic Distance
                let idx1 = getStationIndex(legStartName, currLine);
                let idx2 = getStationIndex(legEndName, currLine);
                
                if(idx1 !== -1 && idx2 !== -1) {
                    dist = Math.abs(idx1 - idx2);
                }

                // 4. Get Fare
                let fare = getStoredFare(currLine, dist, legStartName, legEndName);
                totalCost += fare;
                
                html += `<div class="route-step"><div class="line-dot bg-${currLine}"></div><div class="step-info"><h4>Take ${getFriendlyName(currLine)}</h4><p>Fare: ~${fare}‡∏ø</p></div></div>`;
                
                if(nextLine) {
                    let inter = getInterchange(currLine, nextLine);
                    html += `<div class="route-step"><div class="icon">üîÑ</div><div class="step-info"><h4>Transfer at ${inter}</h4><p>Walk to connecting line</p></div></div>`;
                }
            }
        }
        
        html += `<div class="route-step"><div class="icon">üèÅ</div><div class="step-info"><h4>Arrive ${endObj.n}</h4></div></div>`;

        document.getElementById('res-steps').innerHTML = html;
        document.getElementById('res-price').innerText = `‡∏ø${totalCost}`;
    }

    function getStoredFare(line, distance, sName, eName) {
        if(line === "SRT") {
            if (eName && FARE_TABLES.SRT[eName]) return FARE_TABLES.SRT[eName];
            if (sName && FARE_TABLES.SRT[sName]) return FARE_TABLES.SRT[sName];
            if (distance < 15) return 6; 
            return 20;
        }
        if(FARE_TABLES[line]) {
            const table = FARE_TABLES[line];
            if(distance < table.length) return table[distance];
            return table[table.length - 1]; 
        }
        return 45; 
    }

    init();
</script>

</body>
</html>
